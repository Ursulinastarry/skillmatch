import{c as l}from"./chunk-NZP4ZDRF.js";import{L as n,O as h,T as c,i as o,m as u,x as i}from"./chunk-MZDTUXRP.js";var g=class a{constructor(t){this.http=t;this.checkAuthStatus()}apiUrl="/api";httpOptions={withCredentials:!0};lastAuthCheck=0;userSubject=new o(null);user$=this.userSubject.asObservable();isAuthenticatedSubject=new o(!1);isAuthenticated$=this.isAuthenticatedSubject.asObservable();login(t,e,r){let p={email:t,password:e,roleId:r};return console.log("[Auth Debug] Login attempt:",{email:t,roleId:r,timestamp:new Date().toISOString()}),this.http.post(`${this.apiUrl}/users/login`,p,{withCredentials:!0,observe:"response"}).pipe(n(s=>{console.log("[Auth Debug] Login response headers:",{headers:this.getHeadersAsObject(s.headers),status:s.status,timestamp:new Date().toISOString()}),this.userSubject.next(s.body.user),this.isAuthenticatedSubject.next(!0),this.lastAuthCheck=Date.now(),console.log("[Auth Debug] User authenticated:",{userId:s.body.user.id,timestamp:new Date().toISOString(),validUntil:new Date(this.lastAuthCheck+15*60*1e3).toISOString()})}),i(s=>(console.error("[Auth Debug] Login failed:",{status:s.status,message:s.error?.message||"Unknown error",timestamp:new Date().toISOString()}),this.handleError(s))))}getHeadersAsObject(t){let e={};return t.keys().forEach(r=>{e[r]=t.get(r)}),e}logout(){return this.http.post(`${this.apiUrl}/users/logout`,{},{withCredentials:!0}).pipe(n(()=>{this.userSubject.next(null),this.isAuthenticatedSubject.next(!1)}),i(this.handleError))}checkAuthStatus(){return console.log("[Auth Debug] Checking auth status...",{lastChecked:this.lastAuthCheck?new Date(this.lastAuthCheck).toISOString():"never",timeSinceLastCheck:this.lastAuthCheck?(Date.now()-this.lastAuthCheck)/1e3+"s":"N/A",timestamp:new Date().toISOString()}),this.http.get(`${this.apiUrl}/users/me`,{withCredentials:!0}).pipe(n(t=>{this.userSubject.next(t),this.isAuthenticatedSubject.next(!0),this.lastAuthCheck=Date.now(),console.log("[Auth Debug] Auth check success:",{userId:t.id,timestamp:new Date().toISOString(),validUntil:new Date(this.lastAuthCheck+15*60*1e3).toISOString()})}),i(t=>(this.userSubject.next(null),this.isAuthenticatedSubject.next(!1),console.error("[Auth Debug] Auth check failed:",{status:t.status,message:t.error?.message||"Unknown error",timestamp:new Date().toISOString()}),u(()=>new Error("Not authenticated")))))}inspectCookies(){console.log("[Auth Debug] Document cookies:",{cookies:document.cookie||"No accessible cookies",timestamp:new Date().toISOString()});let t=Date.now()-this.lastAuthCheck,e=15*60*1e3;console.log("[Auth Debug] Auth timeout check:",{lastChecked:new Date(this.lastAuthCheck).toISOString(),timeSinceLastCheck:(t/1e3).toFixed(1)+"s",timeRemaining:((e-t)/1e3).toFixed(1)+"s",shouldRefresh:t>e,timestamp:new Date().toISOString()})}isAuthenticated(){return this.isAuthenticatedSubject.value}getUserRole(){let t=this.userSubject.value;if(!t)return"";let e=t.roleId;return this.roleMap[e]||""}getRoleIdByName(t){return this.roleNameMap[t]||0}handleError(t){return console.error("Auth error:",t),u(()=>new Error(t?.error?.message||"Authentication error"))}roleMap={1:"admin",2:"employer",3:"jobseeker"};roleNameMap={admin:1,employer:2,jobseeker:3};static \u0275fac=function(e){return new(e||a)(c(l))};static \u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})};export{g as a};
